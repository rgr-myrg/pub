!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;((e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).vtg||(e.vtg={})).tracking=t()}}(function(){return function o(s,r,c){function u(e,t){if(!r[e]){if(!s[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(p)return p(e,!0);var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}var i=r[e]={exports:{}};s[e][0].call(i.exports,function(t){return u(s[e][1][t]||t)},i,i.exports,o,s,r,c)}return r[e].exports}for(var p="function"==typeof require&&require,t=0;t<c.length;t++)u(c[t]);return u}({1:[function(t,e,n){"use strict";var a,i=this&&this.__extends||(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__decorate||function(t,e,n,a){var i,o=arguments.length,s=o<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,a);else for(var r=t.length-1;0<=r;r--)(i=t[r])&&(s=(o<3?i(s):3<o?i(e,n,s):i(e,n))||s);return 3<o&&s&&Object.defineProperty(e,n,s),s},s=this&&this.__awaiter||function(t,s,r,c){return new(r=r||Promise)(function(n,e){function a(t){try{o(c.next(t))}catch(t){e(t)}}function i(t){try{o(c.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof r?e:new r(function(t){t(e)})).then(a,i)}o((c=c.apply(t,s||[])).next())})},u=this&&this.__generator||function(n,a){var i,o,s,t,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++,o=e[1],e=[0];continue;case 7:e=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){r=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){r.label=e[1];break}if(6===e[0]&&r.label<s[1]){r.label=s[1],s=e;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(e);break}s[2]&&r.ops.pop(),r.trys.pop();continue}e=a.call(n,r)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};function r(e){return function(t){t.prototype.injectable=e}}Object.defineProperty(n,"__esModule",{value:!0}),n.Injectable=r;var c=(p.prototype.register=function(t){"object"==typeof t&&(this.observers.unshift(t),t.onRegister())},p.prototype.remove=function(e){this.observers=this.observers.filter(function(t){return t!==e})},p.prototype.notify=function(t){for(var e=this.observers.length;e--;){var n=this.observers[e];n.onUpdate.call(n,t)}},p);function p(){this.observers=[]}n.Observable=c;var h=(Object.defineProperty(d,"modules",{get:function(){return[tt,pt,gt]},enumerable:!0,configurable:!0}),d.isDev=function(){return!("dev"!==C.get("ut.env"))},d.version="v0.4.0 2/19/2020",d.platform="CAF",d.ssl=!0,d.tracker={},d);function d(){}n.SystemInfo=h;var f=(l.isWindow=function(){return"object"==typeof window},l.isTop=function(){return"object"==typeof top},l.isVar=function(t,e){var n=t.split(".");return 2===n.length?l.isWindow()&&typeof window[n[0]]===e&&typeof window[n[0]][n[1]]===e:l.isWindow()&&typeof window[t]===e},l.getVar=function(t){return l.isWindow()&&window[t]},l.getScreenSize=function(){var t=window;return l.isWindow()&&t.screen&&t.screen.width&&t.screen.height?t.screen.width+"x"+t.screen.height:"N/A"},l.isHttps=function(){return l.isTop()&&-1<top.location.href.search(/^https/)},l.getProtocol=function(){return!l.isTop()||l.isHttps()?"https://":"http://"},l.stringify=function(t){return l.isWindow&&l.getVar("JSON")?window.JSON.stringify(t):t.toString()},l);function l(){}n.View=f;var v=(g.POST=function(t){var e=new XMLHttpRequest,n=g.makeUrl(t.ssl,t.url);e.open("POST",n,!0),e.setRequestHeader("Content-Type",t.type||"application/json"),e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&t.callback({xhr:e,status:e.status,text:200<=e.status&&e.status<300||304===e.status?e.responseText:e.statusText})},e.onerror=function(){t.callback({xhr:e,status:-1,text:"Error "+e.status})},e.send(t.data)},g.GET=function(t){var e=new XMLHttpRequest,n=g.makeUrl(t.ssl,-1===t.url.indexOf("?")?t.url+"?"+t.data:t.url);e.open("GET",n,!0),e.onload=function(){t.callback({xhr:e,status:e.status,text:e.responseText})},e.send()},g.makeUrl=function(t,e){return(t?"https:":"http:")+"//"+e},g);function g(){}n.HttpRequest=v;var y=(m.setLogger=function(t){"object"==typeof t&&"function"==typeof t.log&&(m.logger=t)},m.logger=console||null,m);function m(){}n.Log=y;var S=(E.prototype.add=function(t){this.items.unshift(t)},E.prototype.each=function(t){if(!this.isRunning){this.isRunning=!0;for(var e=this.items.length;e--;){var n=this.items.pop();n&&t(n)}this.isRunning=!1}},E.prototype.isEmpty=function(){return 0===this.items.length},E);function E(){this.items=[],this.isRunning=!1}n.Queue=S;var I=(b.trim=function(t){return t.replace(/^\s+|\s$/g,"")},b.isDefined=function(t){return!(void 0===t||"undefined"===t||""===t)},b);function b(){}n.StringUtil=I;var k=(T.prototype.start=function(t){setInterval&&(this.isRunning||(this.intervalId=setInterval(t,this.milliseconds),this.isRunning=!0))},T.prototype.stop=function(){clearInterval&&(clearInterval(this.intervalId),this.isRunning=!1)},T);function T(t){this.milliseconds=t,this.isRunning=!1}function D(n){return function(t,e){t.keys||(t.keys={}),t.keys[e]=function(t){return t.hasOwnProperty(e)&&t[e]?t[e]:"boolean"!=typeof n?n||"":n}}}n.Timer=k,n.ConfigParam=D;var P=(w.prototype.format=function(){var e=this,n=this,a=this.agent.config.params;return Object.keys(this.keys).forEach(function(t){n[t]=e.keys[t](a)}),n},w.prototype.mapData=function(t){var e=new x([M.ReplaceTokens,M.Ternary,M.OrCondition,M.DataType]),n=this.agent.getData();return e.addSource("data",n),e.addSource("context",n.contextData||{}),e.addSource("config",this.agent.config.params),e.setMap(t),e.setType(this.dataType),e.getData()},w);function w(t){this.agent=t,this.dataType={},this.format()}n.DataAccess=P;var C=(A.get=function(t){var e=window;return e.utag&&e.utag.data?e.utag.data[t]:""},A);function A(){}n.DataLayer=C;var R=(O.prototype.update=function(t){this.data=this.merge(t),this.data.timestamp=(new Date).getTime(),this.data.utcSeconds=Math.round((new Date).getTime()/1e3)},O.prototype.getData=function(){return this.data},O.prototype.merge=function(n){var a=this.data;return Object.keys(n).forEach(function(t){var e=n[t];null!=e&&(a[t]=e)}),a},O);function O(){this.data={}}n.DataProxy=R;var _=(L.get=function(t){var e=window,n="";return e.localStorage&&(n=e.localStorage.getItem(t)),n||""},L.set=function(t,e){var n=window;n.localStorage&&n.localStorage.setItem(t,e)},L);function L(){}n.DataStorage=_;var M=(U.ReplaceTokens=function(i){var o={};return Object.keys(i.map).forEach(function(a){var t=i.map[a],e=t?t.toString().match(/\{\w+.\w+\}/g):null;o[a]=i.map[a],e&&e.forEach(function(t){var e=t.replace(/\{|\}/g,"").split("."),n=i.source[e[0]][e[1]];o[a]=o[a].replace(t.toString(),n)})}),o},U.Ternary=function(i){var o={};return Object.keys(i.data).forEach(function(t){var e=i.data[t].toString().match(/(.+)\?(.+):(.+)/);if(e&&3<e.length){var n=I.trim(e[1]),a=!1;"true"!==n&&"undefined"===n||(a=!0),"false"!==n&&""!==n||(a=!1),o[t]=a?e[2]:e[3],o[t]=I.trim(o[t])}else o[t]=i.data[t]}),o},U.OrCondition=function(o){var s={};return Object.keys(o.data).forEach(function(t){var e=o.data[t].toString(),n=e.match(/(.+)\|\|(.+)/);if(s[t]=e,n&&2<n.length){var a=I.trim(n[1]||""),i=I.trim(n[2]||"");I.isDefined(a)?s[t]=a:I.isDefined(i)&&(s[t]=i)}}),s},U.DataType=function(n){var a={};return Object.keys(n.data).forEach(function(t){var e=n.data[t].toString();if(e)switch(n.types[t]){case"int":a[t]=parseInt(e);break;case"boolean":a[t]="true"===e;break;default:a[t]=e}}),a},U);function U(){}n.Rules=M;var x=(B.prototype.addSource=function(t,e){this.source[t]=e},B.prototype.setMap=function(t){this.map=t},B.prototype.setType=function(t){this.types=t},B.prototype.getData=function(){for(var t={},e=0,n=this.rules;e<n.length;e++)t=(0,n[e])({source:this.source,map:this.map,data:t,types:this.types});return t},B);function B(t){this.rules=[],this.source={},this.map={},this.types={},this.rules=t}n.RulesEngine=x;var N=(j.prototype.onRegister=function(){},j.prototype.onUpdate=function(t){var e=this;this.notifications.add(t),this.hasSdkLoaded()&&this.notifications.each(function(t){e.onNotify(t)})},j.prototype.hasSdkLoaded=function(){if("object"!=typeof this.injectable)return this.isSdkLoaded;var t=this.injectable,e=f.getVar(t.name);return e&&(this[t.name]=e,this.isSdkLoaded=!0),this.isSdkLoaded},j.prototype.onNotify=function(t){var e={isAd:!1,adBreakType:"preroll"};switch((this.notification=t).name){case"adBreakStart":case"adStart":e.isAd=!0;var n=t.body;n&&n.adBreakType&&(e.adBreakType=n.adBreakType.toLowerCase()+"roll");break;case"adEnd":case"adBreakEnd":case"contentStart":e.isAd=!1}this.observable.dataProxy.update(e);var a=this.events[t.name];a&&a.call(this)},j.prototype.getData=function(){return this.observable.dataProxy.getData()},j.prototype.hasContentCompleted=function(){var t=this.getData();return(!t||!t.isLive)&&t.playhead>=.95*t.duration},j);function j(t,e){this.config=t,this.observable=e,this.events={},this.notifications=new S,this.isSdkLoaded=!1,this.isDev=!1,this.isDev=e.isDev}function q(){return function(t,e){t.observer=!0}}n.Agent=N,n.Subscribe=q;var H=(z.prototype.startUp=function(a){var i=this;nt.request(a).then(function(t){var e=new x([M.ReplaceTokens]),n=a.params.serverInfo;e.addSource("config",{reportSuite:h.isDev()?n.devSuite:n.prodSuite,mid:t.d_mid}),e.setMap(a.params.appTrackingInfo),i.info=e.getData(),i.api=new rt(i.info.dataUrl),i.isReady=!0,delete i.info.dataUrl,i.flush()})},z.prototype.track=function(t){this.queue.add(t),this.isReady&&this.flush()},z.prototype.flush=function(){var e=this;this.queue.each(function(t){e.post(t)})},z.prototype.post=function(t){for(var e in this.info)t[e]||(t[e]=this.info[e]);this.api&&this.api.post(t)},z);function z(t){this.config=t,this.queue=new S,this.isReady=!1,this.info={};var e=t.Adobe;e&&e.enabled&&this.startUp(e)}n.AppTracker=H;var K=(F.prototype.onRegister=function(){},F.prototype.onUpdate=function(t){switch(t.name){case"contentStart":this.hasSessionEnd=!1,this.hasContentStart=!0;break;case"adBreakStart":this.isAd=!0,this.timer.stop();break;case"adBreakEnd":this.isAd=!1,this.isStopped=!0;break;case"contentPause":case"bufferStart":case"seekStart":this.isStopped=!0,this.startHb();break;case"timeUpdate":this.timeUpdate();break;case"contentEnd":case"sessionEnd":this.hasSessionEnd=!0,this.hasContentStart=!1,this.isStopped=!0,this.timer.stop()}},F.prototype.timeUpdate=function(){this.hasSessionEnd||this.isStopped&&this.hasContentStart&&!this.isAd&&(this.isStopped=!1,this.startHb())},F.prototype.startHb=function(){var t=this;this.timer.stop(),this.timer.start(function(){t.tracker.track("hb")})},F.NAME="Hb",F);function F(t){this.tracker=t,this.hasContentStart=!1,this.hasSessionEnd=!1,this.isStopped=!0,this.isAd=!1,this.config={name:"Hb",enabled:!0,params:{}},this.timer=new k(1e4)}n.Heartbeat=K;var V=(G.prototype.register=function(a){var i=this;this.tracker=a,this.registerAgent(new K(a)),this.tracker.modules.forEach(function(t){var e=t;if(i.isAgentEnabled(e.NAME)){var n=i.getAgentConfig(e.NAME);i.registerAgent(new e(n,a))}})},G.prototype.isAgentEnabled=function(t){return this.tracker.config.hasOwnProperty(t)&&this.tracker.config[t].hasOwnProperty("enabled")&&this.tracker.config[t].enabled},G.prototype.getAgentConfig=function(t){var e=this.tracker.config[t];return e.params||(e.params={}),e.name||(e.name=t),e.params.debug=h.isDev(),e},G.prototype.registerAgent=function(e){this.tracker.observers.find(function(t){return t.config.name===e.config.name})||this.tracker.register(e)},G);function G(){}n.Registrar=V;var W,Q=(i(X,W=c),X.prototype.track=function(t,e){if("sessionStart"===t&&(this.dataProxy=new R),e=e||{},"timeUpdate"===t){if(!this.hasProgress(e.playhead))return;e.playhead=this.playhead}e.playhead=e.playhead?Math.floor(e.playhead):this.playhead,this.playhead=e.playhead,this.dataProxy.update(e),this.isDev&&y.logger.log(this.logId,t,e),this.notify({name:t})},X.prototype.hasProgress=function(t){var e=Math.floor(t);return!isNaN(e)&&this.playhead!==e&&(this.playhead=e,!0)},X.prototype.setConfig=function(t){this.isDev=h.isDev(),this.isDev&&y.logger.log(this.logId,"setConfig",t),this.config||"object"==typeof t&&(this.config=t,this.registrar.register(this))},X);function X(){var t=null!==W&&W.apply(this,arguments)||this;return t.modules=h.modules,t.dataProxy=new R,t.registrar=new V,t.playhead=0,t.isDev=!1,t.logId="[Tracker]",t}n.VideoTracker=Q;var Y,J=(i($,Y=Q),$.prototype.onNotify=function(t){var e=this.eventMap[t.type];e&&e.call(this,t)},$.prototype.on=function(t,e){this.callback[t]=e},$.prototype.startSession=function(t){this.hasPlayerLoaded&&!this.hasSessionStart&&(this.hasSessionStart=!0,this.event("sessionStart",t,{playerManager:this.playerManager,playerInitTime:(new Date).getTime()}))},$.prototype.endSession=function(t){this.event("contentEnd",t),this.hasPlayerLoaded=!1,this.hasSessionStart=!1,this.hasClipStarted=!1,this.hasBreakStarted=!1,this.isAdPlaying=!1,this.isBuffering=!1,this.isPaused=!1,this.event("sessionEnd",t)},$.prototype.event=function(t,e,n){var a=n||{};if("function"==typeof this.callback[t]){var i=this.callback[t](e);"object"==typeof i&&(Object.keys(i).forEach(function(t){a[t]=i[t]}),delete this.callback[t])}a.season&&(a.seasonNumber=a.season),a.episode&&(a.episodeNumber=a.episode),a.playhead=e.currentMediaTime,Y.prototype.track.call(this,t,a)},$.prototype.setContextData=function(t){this.dataProxy.update({contextData:t})},$);function $(){var n=Y.call(this)||this;return n.hasPlayerLoaded=!1,n.hasSessionStart=!1,n.hasClipStarted=!1,n.hasBreakStarted=!1,n.isBuffering=!1,n.isAdPlaying=!1,n.isPaused=!1,n.isSeeking=!1,n.callback={},n.startTime=0,n.eventMap={PLAYER_LOAD_COMPLETE:function(t){n.hasPlayerLoaded=!0,n.event("playerLoaded",t),n.startTime=(new Date).getTime()},CLIP_STARTED:function(t){if(!n.isAdPlaying||!n.hasClipStarted){if(n.hasPlayerLoaded&&!n.hasClipStarted){var e=Math.abs((new Date).getTime()-n.startTime)/1e3;n.startSession(t),n.event("contentStart",t,{timeToStart:e})}n.hasClipStarted=!0}},BREAK_STARTED:function(t){n.hasPlayerLoaded&&(n.startSession(t),n.hasBreakStarted=!0,n.event("adBreakStart",t))},BREAK_CLIP_STARTED:function(t){n.hasPlayerLoaded&&(n.hasBreakStarted||n.eventMap.BREAK_STARTED(t),n.isAdPlaying=!0,n.event("adStart",t))},BREAK_CLIP_ENDED:function(t){n.isAdPlaying=!1,n.isPaused=!1,"SKIPPED"===t.endedReason&&n.event("adSkip",t),n.event("adEnd",t)},BREAK_ENDED:function(t){n.isAdPlaying=!1,n.hasBreakStarted=!1,n.event("adBreakEnd",t)},BUFFERING:function(t){n.hasSessionStart&&!n.isBuffering&&(n.isBuffering=!0,n.event("bufferStart",t))},TIME_UPDATE:function(t){n.isBuffering&&(n.isBuffering=!1,n.event("bufferEnd",t)),n.isPaused||n.event("timeUpdate",t)},PLAYING:function(t){n.isPaused&&(n.isPaused=!1,n.event(n.isAdPlaying?"adResume":"contentResume",t))},PAUSE:function(t){n.isPaused||(n.isPaused=!0,n.event(n.isAdPlaying?"adPause":"contentPause",t))},REQUEST_SEEK:function(t){n.isSeeking=!0,n.event("seekStart",t)},SEEKED:function(t){n.isSeeking&&(n.event("seekEnd",t),n.isSeeking=!1)},BITRATE_CHANGED:function(t){n.event("bitrateChange",t,{bitrate:t.totalBitrate})},MEDIA_FINISHED:function(t){n.endSession(t)},ERROR:function(t){t&&t.endedReason&&t.endedReason===cast.framework.events.EndedReason.ERROR&&n.event("playerError",t,{errorCode:t.detailedErrorCode,errorMessage:t.endedReason,isFatal:!1})}},n.context=cast.framework.CastReceiverContext.getInstance(),n.playerManager=n.context.getPlayerManager(),["PLAYER_LOAD_COMPLETE","CLIP_STARTED","BREAK_STARTED","BREAK_CLIP_STARTED","BREAK_CLIP_ENDED","BREAK_ENDED","BUFFERING","TIME_UPDATE","PLAYING","PAUSE","REQUEST_SEEK","SEEKED","BITRATE_CHANGED","MEDIA_FINISHED","ERROR"].forEach(function(t){n.playerManager.addEventListener(t,n.onNotify.bind(n))}),n.context.addEventListener(cast.framework.system.EventType.SHUTDOWN,n.endSession.bind(n)),n}n.ChromecastTracker=J;var Z,tt=(i(et,Z=N),et.prototype.onRegister=function(){Z.prototype.onRegister.call(this),this.dao=new ot(this),this.eventQueue=new S},et.prototype.flushQueue=function(){var e=this;this.hasSession&&this.eventQueue.each(function(t){e.postRequest(t)})},et.prototype.postRequest=function(t){"play"===t&&this.getData().isAd||v.POST({url:this.eventUrl,ssl:this.dao.enableSSL,data:f.stringify(this.dao.getPayload(t)),callback:Function.prototype})},et.prototype.startSession=function(){var n=this;this.hasSessionRequest||(v.POST({url:this.dao.getSessionUrl(),ssl:this.dao.enableSSL,data:f.stringify(this.dao.getSessionInfo()),callback:function(t){if(400===t.status)throw"Error: Server 400";var e=t.xhr.getResponseHeader("location");if(!e)throw"Error: Location not found";n.hasSession=!0,n.eventUrl=n.dao.getEventUrl(e),n.flushQueue()}}),this.hasSessionRequest=!0)},et.prototype.trackEvent=function(t){this.eventQueue.add(t),this.flushQueue()},et.prototype.contentStart=function(){this.startSession(),this.trackEvent("play")},et.prototype.play=function(){this.hasStateChange&&(this.hasStateChange=!1,this.trackEvent("play"))},et.prototype.ping=function(){this.trackEvent("ping")},et.prototype.sessionEnd=function(){this.hasSession&&(this.hasContentCompleted()&&this.trackEvent("sessionComplete"),this.trackEvent("sessionEnd"),this.hasSession=!1),this.hasSessionRequest=!1},et.NAME="Adobe",o([q()],et.prototype,"events",void 0),et);function et(){var e=null!==Z&&Z.apply(this,arguments)||this;return e.hasSession=!1,e.hasSessionRequest=!1,e.hasStateChange=!1,e.isSdkLoaded=!0,e.hasNewSegment=!1,e.events={adBreakStart:function(){e.startSession(),e.trackEvent("adBreakStart")},adStart:function(){e.trackEvent("adStart")},adPause:function(){e.trackEvent("pauseStart"),e.hasStateChange=!0},adSkip:function(){e.trackEvent("adSkip")},adEnd:function(){e.trackEvent("adComplete")},adBreakEnd:function(){e.trackEvent("adBreakComplete"),e.hasStateChange=!0},contentPause:function(){e.hasStateChange=!0,e.trackEvent("pauseStart")},bufferStart:function(){e.hasStateChange=!0,e.trackEvent("bufferStart")},seekStart:function(){e.hasStateChange=!0},cuePoint:function(){if(e.getData().isLive||e.dao.isOwner()){var t=e.getData().segmentId;e.liveSegmentId!==t&&e.dao.liveSegmentInfo?(e.liveSegmentId=t,e.hasNewSegment=!0,e.sessionEnd(),e.contentStart()):e.hasNewSegment=!1}},playerError:function(){e.trackEvent("error"),e.sessionEnd()},contentStart:e.contentStart,contentResume:e.play,adResume:e.play,timeUpdate:e.play,hb:e.ping,sessionEnd:e.sessionEnd},e}n.AdobeAgent=tt;var nt=(at.request=function(c){return s(this,void 0,void 0,function(){var e,n,a,i,o,s,r;return u(this,function(t){return e=c.params.accountInfo["visitor.marketingCloudOrgId"],n=c.params.serverInfo.demdexUrl+e,a=h.ssl,i="d_mid",o=function(t){v.GET({url:n,data:null,ssl:a,callback:t})},(s=f.getVar("Visitor"))?(r=s.getInstance(e),[2,new Promise(function(t,e){var n=r.getMarketingCloudVisitorID();n?(_.set(i,n),t({d_mid:n})):e(new Error("visitor not found"))})]):_.get(i)?[2,new Promise(function(t,e){t({d_mid:_.get(i)})})]:[2,new Promise(function(n,a){o(function(t){if(-1===t.status)a(new Error(t.text));else{var e=JSON.parse(t.text)[i];e?(_.set(i,e),n({d_mid:e})):a(new Error("d_mid not found"))}})})]})})},at.getMid=function(){var t=_.get("d_mid");return t||""},at);function at(){}n.AdobeCloudId=nt;var it,ot=(i(st,it=P),st.prototype.getSessionInfo=function(){var t=this.getPayload("sessionStart");if(this.agent.config.params.reportSuite=this.agent.isDev?this.serverInfo.devSuite:this.serverInfo.prodSuite,t.params=Object.assign(this.mapData(this.mediaInfo),this.mapData(this.accountInfo)),t.customMetadata=this.mapData(Object.assign(this.agent.getData().contextData||{},this.customData)),t.qoeData=this.mapData(this.qoeData),this.agent.hasNewSegment){var e=this.mapData(this.liveSegmentInfo);t.params=Object.assign(t.params,e)}return t},st.prototype.getAdBreakInfo=function(){return this.mapData(this.adBreakInfo)},st.prototype.getAdInfo=function(){return this.mapData(this.adInfo)},st.prototype.getSessionUrl=function(){return[this.agent.isDev?this.serverInfo.devUrl:this.serverInfo.prodUrl,st.SESSION_PATH].join("/")},st.prototype.getEventUrl=function(t){return[this.agent.isDev?this.serverInfo.devUrl:this.serverInfo.prodUrl,t.replace(/^\/|\/$/g,""),"events"].join("/")},st.prototype.getPayload=function(t){var e=this.agent.getData(),n={};switch(t){case"adBreakStart":n=this.getAdBreakInfo();break;case"adStart":n=this.getAdInfo()}return{eventType:t,playerTime:{playhead:e.playhead,ts:(new Date).getTime()},params:n}},st.prototype.isOwner=function(){return this.agent.getData().segmentOwner===this.serverInfo.id3Owner},st.SESSION_PATH="api/v1/sessions",o([D(!0)],st.prototype,"enableSSL",void 0),o([D()],st.prototype,"serverInfo",void 0),o([D()],st.prototype,"accountInfo",void 0),o([D()],st.prototype,"mediaInfo",void 0),o([D()],st.prototype,"adBreakInfo",void 0),o([D()],st.prototype,"adInfo",void 0),o([D()],st.prototype,"customData",void 0),o([D()],st.prototype,"qoeData",void 0),o([D()],st.prototype,"dataType",void 0),o([D()],st.prototype,"liveSegmentInfo",void 0),st);function st(t){var e=it.call(this,t)||this;return e.agent=t,e.enableSSL="true"===e.accountInfo["analytics.enableSSL"],e.serverInfo.demdexUrl&&nt.request(t.config).then(function(t){e.agent.config.params.mid=t.d_mid}),e}n.AdobeDao=ot;var rt=(ct.prototype.post=function(e){return s(this,void 0,void 0,function(){var a,i;return u(this,function(t){return a=this.request.bind(this),i=this.format(e),[2,new Promise(function(e,n){a(i,function(t){-1===t.status?n(new Error(t.text)):e(t)})})]})})},ct.prototype.request=function(t,e){v.POST({url:this.url,data:t,ssl:h.ssl,callback:e})},ct.prototype.format=function(t){return['<?xml version="1.0" encoding="UTF-8"?>',"<request>",this.toXml(t),"</request>"].join("")},ct.prototype.toXml=function(e){var n=this,a="";return Object.keys(e).forEach(function(t){a+="<{key}>{value}</{key}>".replace(/{key}/g,t).replace(/{value}/g,"object"!=typeof e[t]?n.htmlEntities(e[t]):n.toXml(e[t]))}),a},ct.prototype.htmlEntities=function(t){if(!t)return t;function n(t){return["&",t,";"].join("")}return t.toString().replace(/&|"|'|<|>/g,function(t){var e=t.toString();switch(e){case"&":e=n("amp");break;case'"':e=n("quot");break;case"'":e=n("apos");break;case"<":e=n("lt");break;case">":e=n("gt")}return e})},ct);function ct(t){this.url=t}n.AdobeData=rt;var ut,pt=(i(ht,ut=N),ht.prototype.onRegister=function(){ut.prototype.onRegister.call(this),this.dao=new ft(this)},ht.prototype.timeUpdate=function(){this.getData().isAd||(this.hasContentStart&&(this.startSession(),this.begin(),this.hasContentStart=!1),this.isStopped&&(this.isStopped=!1,this.ozTamInstance&&this.ozTamInstance.resumeProgress()))},ht.prototype.startSession=function(){var t=this.dao.getConfigInfo();this.ozTamInstance=new this.OzTAMService(t.publisherId,t.vendorVersion,t.productionMode,t.verboseLogging,t.useHTTPS),this.mediaInfo=this.dao.getMediaInfo(),this.ozTamInstance&&this.ozTamInstance.startSession(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaType)},ht.prototype.begin=function(){this.ozTamInstance&&this.ozTamInstance.beginPlayback(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaPositionFunction,this.dao.getPropertyInfo(),this.mediaInfo.mediaType)},ht.prototype.stop=function(){this.isStopped=!0,this.ozTamInstance&&this.ozTamInstance.haltProgress()},ht.NAME="OzTam",o([q()],ht.prototype,"events",void 0),ht=o([r({name:"OzTAMService",type:"function"})],ht));function ht(){var t=null!==ut&&ut.apply(this,arguments)||this;return t.hasContentStart=!1,t.isStopped=!1,t.events={contentStart:function(){t.hasContentStart=!0},seekStart:function(){t.ozTamInstance&&t.ozTamInstance.seekBegin()},seekEnd:function(){t.ozTamInstance&&t.ozTamInstance.seekComplete(),t.isStopped=!0},contentEnd:function(){t.ozTamInstance&&t.ozTamInstance.complete()},contentPause:t.stop,bufferStart:t.stop,contentResume:t.timeUpdate,timeUpdate:t.timeUpdate},t}n.OzTamAgent=pt;var dt,ft=(i(lt,dt=P),lt.prototype.getConfigInfo=function(){return{publisherId:this.agent.getData().isLive?this.serverInfo.liveKey:this.serverInfo.vodKey,vendorVersion:this.getVersion(),productionMode:this.serverInfo.productionMode,verboseLogging:this.agent.isDev,useHTTPS:this.serverInfo.useHTTPS}},lt.prototype.getVersion=function(){var t=this.agent.getData(),e=t.isMobile?"Mobile-Web":"Desktop-Web";return"CAF"===h.platform&&(e="Chromecast"),[this.serverInfo.platform,e,t.playerVersion].join("_")},lt.prototype.getMediaInfo=function(){var t=this.agent.getData(),e=this.mapData(this.mediaInfo),n=function(){return t.playhead}.bind(this);return e.mediaPositionFunction=n,e},lt.prototype.getPropertyInfo=function(){var t=this.agent.getData(),e={};return t.ozTamMediaId&&(e.altMediaId=t.mediaId),t.userId&&(e.demo1=t.userId),e},o([D()],lt.prototype,"serverInfo",void 0),o([D()],lt.prototype,"mediaInfo",void 0),lt);function lt(t){var e=dt.call(this,t)||this;return e.agent=t,e}n.OzTamDao=ft;var vt,gt=(i(yt,vt=N),yt.prototype.onRegister=function(){vt.prototype.onRegister.call(this),this.dao=new St(this)},yt.prototype.createSession=function(){if(!(-1<this.sessionId)&&this.dao.getCastPlayerManager()){var t=this.dao.getCustomerKey();if(this.isDev?(this.Conviva.LivePass.toggleTraces(!0),this.Conviva.LivePass.initWithSettings(t,this.dao.getInitOptions())):(this.Conviva.LivePass.toggleTraces(!1),this.Conviva.LivePass.init(t)),this.playerManager=this.dao.getCastPlayerManager(),this.streamer=new this.Conviva.ConvivaCastV3StreamerProxy(this.playerManager),this.streamer){var e=this.dao.getContentInfo();this.sessionId=this.Conviva.LivePass.createSession(this.streamer,e,this.dao.getSessionOptions())}}},yt.prototype.bitrateChange=function(){-1<this.sessionId&&!this.getData().isAd&&this.Conviva.LivePass.setBitrate(this.sessionId,this.getData().bitrate)},yt.prototype.playerError=function(){var t=this.dao.getConvivaError();this.Conviva.LivePass.reportError(t.sessionId,t.message,t.type),this.getData().errorFatal&&this.Conviva.LivePass.cleanupSession(this.sessionId)},yt.prototype.cleanUpSession=function(){this.Conviva.LivePass.cleanupSession(this.sessionId),this.sessionId=-1},yt.NAME="ConvivaCast",o([q()],yt.prototype,"events",void 0),yt=o([r({name:"Conviva",type:"function"})],yt));function yt(){var t=null!==vt&&vt.apply(this,arguments)||this;return t.sessionId=-1,t.events={contentStart:t.createSession,sessionEnd:t.cleanUpSession,playerError:t.playerError,bitrateChange:t.bitrateChange},t}n.ConvivaCastAgent=gt;var mt,St=(i(Et,mt=P),Et.prototype.getCustomerKey=function(){return this.agent.isDev?this.serverInfo.devKey:this.serverInfo.prodKey},Et.prototype.getInitOptions=function(){var t=this.agent.isDev?this.serverInfo.devUrl:this.serverInfo.prodUrl;return{gatewayUrl:f.getProtocol()+t}},Et.prototype.getSessionOptions=function(){var t;return(t={})[this.agent.Conviva.LivePass.OPTION_EXTERNAL_BITRATE_REPORTING]=!0,t},Et.prototype.getContentInfo=function(){var t=Object.assign(new this.agent.Conviva.ConvivaContentInfo,this.mapData(this.contentInfo));return t.tags=this.mapData(this.customTagInfo),t},Et.prototype.getConvivaError=function(){var t=this.agent.getData(),e=this.agent.Conviva.StreamerError;return this.mapData({sessionId:this.agent.sessionId,message:[t.errorType,t.errorMessage].join(":"),type:t.errorFatal?e.SEVERITY_FATAL:e.SEVERITY_WARNING})},Et.prototype.getCastPlayerManager=function(){return this.agent.getData().playerManager},o([D()],Et.prototype,"serverInfo",void 0),o([D()],Et.prototype,"contentInfo",void 0),o([D()],Et.prototype,"cdnInfo",void 0),o([D()],Et.prototype,"customTagInfo",void 0),Et);function Et(t){var e=mt.call(this,t)||this;return e.agent=t,e}n.ConvivaCastDao=St},{}]},{},[1])(1)});